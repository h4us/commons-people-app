<GridLayout height="100%" rows="60,*">
  <!--
       So tricky behavior..
       refs. https://github.com/tjvantoll/nativescript-IQKeyboardManager/issues/42#issuecomment-430179177
  -->

  <!-- <StackLayout #sizeAnchor class="util-anchor-full"></StackLayout> -->

  <StackLayout row="0" class="bg-theme-secondary" height="60">
    <CustomActionBar [title]="title" leftIcon="&#xe92f;" rightIcon="&#xea0a;" thirdIcon="{{ threadObj?.group ? '&#xe9c4;' : '' }}"
      (onAprove)="sendPoint()"
      (onExtraTap)="goToSettings()"></CustomActionBar>
  </StackLayout>

  <ScrollView width="100%" row="1" enabled="false">

    <GridLayout rows="*" height="100%" class="bg-theme-secondary">

      <ScrollView #mContent row="0"
        marginBottom="70"
        (tap)="onActiveContentArea()"
        (touch)="onActiveContentArea()">
        <!-- // -->
        <StackLayout row="0">
          <ng-template ngFor let-item [ngForOf]="messageLog" let-i="index">
            <StackLayout class="p-x-30 p-y-15 bg-theme-secondary">
              <GridLayout *ngIf="(item.createdBy && (item.createdBy == user.id)); else elseBlock" columns="*" rows="*" class="bg-clear">
                <StackLayout col="0" class="p-15 bg-bubble" style="border-radius:20;">
                  <Label class="bg-clear typo-message" textWrap="true" [text]="item.text"></Label>
                </StackLayout>
              </GridLayout>
              <ng-template #elseBlock>
                <GridLayout columns="40,*" rows="*" class="bg-clear">
                  <Image col="0" class="m-x-10" style="border-radius:80;" stretch="aspectFill" width="32" height="32" verticalAlignment="top"
                    src="{{ item.photoUrl || '~/assets/placeholder__group.png' }}"></Image>
                  <StackLayout col="1" class="p-15 bg-white" style="border-radius:20;">
                    <Label class="bg-clear typo-message" textWrap="true" [text]="item.text"></Label>
                  </StackLayout>
                </GridLayout>
              </ng-template>
            </StackLayout>
          </ng-template>

          <StackLayout height="70" class="bg-clear"></StackLayout>
        </StackLayout>
        <!-- // -->
      </ScrollView>

      <FlexboxLayout row="0"
        flexDirection="column"
        justifyContent="flex-end"
        android:isUserInteractionEnabled="false"
        ios:isPassThroughParentEnabled="true">

          <!--
               <ScrollView col="0"
               [height]="limH"
               class="debug-border"
               alignSelf="flex-start"
               ios:isPassThroughParentEnabled="true"
               style="background-color:rgba(0,0,0,.1);">
          -->

          <FlexboxLayout
            [height]="limH"
            flexDirection="column"
            justifyContent="flex-end"
            class="bg-clear"
            ios:isPassThroughParentEnabled="true">

            <FlexboxLayout #sendTray
              flexDirection="row"
              justifyContent="space-between"
              class="p-x-15 p-y-12 bg-white">

              <FlexboxLayout flexDirection="column"
                justifyContent="flex-end"
                class="form msgbox">

                <TextView #sendInput
                  editable="true" class="input" hint="Aa"
                  style="border-color:transparent; background-color:transparent;"
                  [formControl]="sendText"
                  (tap)="onFocus()"></TextView>
              </FlexboxLayout>

              <FlexboxLayout flexDirection="column"
                visibility="{{ isEmpty ? 'collapsed' : 'visible' }}"
                width="120"
                justifyContent="flex-end"
                class="bg-white searchbox-like-container">
                <Label class="icon followIcon text-center p-l-5 p-b-5"
                  text="&#xe9c2;"
                  (tap)="sendMessage()"></Label>
              </FlexboxLayout>

            </FlexboxLayout>

          </FlexboxLayout>

          <!--
               </ScrollView>
          -->

      </FlexboxLayout>

    </GridLayout>

  </ScrollView>

</GridLayout>
