<GridLayout height="100%" rows="60,*">
  <!--
       So tricky behavior..
       refs. https://github.com/tjvantoll/nativescript-IQKeyboardManager/issues/42#issuecomment-430179177
  -->

  <StackLayout row="0" class="bg-theme-secondary" height="60">
    <CustomActionBar [title]="title" leftIcon="&#xe92f;" rightIcon="&#xea0a;" thirdIcon="{{ threadObj?.group ? '&#xe9c4;' : '' }}"
      (onAprove)="sendPoint()"
      (onExtraTap)="goToSettings()"></CustomActionBar>
  </StackLayout>

  <ScrollView width="100%" row="1" enabled="false">

    <GridLayout rows="*" height="100%" class="bg-theme-secondary">

      <ScrollView #mContent row="0"
        marginBottom="70"
        (tap)="onActiveContentArea()"
        (touch)="onActiveContentArea()">
        <!-- // -->
        <StackLayout>
          <ActivityIndicator *ngIf="messageLog?.length == 0" busy="true" width="20"></ActivityIndicator>

          <ng-template ngFor let-item [ngForOf]="messageLog" let-i="index">
            <StackLayout class="p-x-15 p-y-10 bg-theme-secondary">

              <FlexboxLayout *ngIf="(item.createdBy && (item.createdBy == user.id)); else elseBlock"
                justifyContent="flex-end"
                class="bg-clear">
                <StackLayout alignSelf="center" class="bg-bubble" android:style="border-radius:20; padding-top:5; padding-bottom:5;"
                  ios:style="border-radius:20; padding-top:10; padding-bottom:10;">
                  <Label class="bg-clear typo-message m-x-15" textWrap="true" [text]="item.text"></Label>
                </StackLayout>
              </FlexboxLayout>

              <ng-template #elseBlock>

                <DockLayout class="bg-clear" stretchLasthChild="false">
                  <StackLayout dock="left" width="52">
                    <Image class="m-x-10" style="border-radius:80;" stretch="aspectFill" width="32" height="32" verticalAlignment="top"
                      src="{{ getAvatar(item.createdBy) }}"></Image>
                  </StackLayout>

                  <FlexboxLayout>
                    <StackLayout alignSelf="flex-start" class="bg-white" android:style="border-radius:20; padding-top:5; padding-bottom:5;"
                      ios:style="border-radius:20; padding-top:10; padding-bottom:10;">
                      <Label class="bg-clear typo-message m-x-15" textWrap="true" [text]="item.text"></Label>
                    </StackLayout>
                  </FlexboxLayout>
                </DockLayout>

              </ng-template>

            </StackLayout>
          </ng-template>

          <StackLayout height="70" class="bg-clear"></StackLayout>
        </StackLayout>
        <!-- // -->
      </ScrollView>

      <FlexboxLayout row="0"
        flexDirection="column"
        justifyContent="flex-end"
        android:isUserInteractionEnabled="false"
        ios:isPassThroughParentEnabled="true">

        <FlexboxLayout
          [height]="limH"
          flexDirection="column"
          justifyContent="flex-end"
          class="bg-clear"
          ios:isPassThroughParentEnabled="true">

          <FlexboxLayout #sendTray
            flexDirection="row"
            justifyContent="space-between"
            class="p-x-15 p-y-12 bg-white">

            <FlexboxLayout flexDirection="column"
              justifyContent="flex-end"
              class="form msgbox">

              <TextView #sendInput
                editable="true" class="input" hint="Aa"
                style="border-color:transparent; background-color:transparent;"
                [formControl]="sendText"
                (tap)="onFocus()"></TextView>
            </FlexboxLayout>

            <FlexboxLayout flexDirection="column"
              visibility="{{ isEmpty ? 'collapsed' : 'visible' }}"
              width="120"
              justifyContent="flex-end"
              class="bg-white searchbox-like-container">
              <Label class="icon followIcon text-center p-l-5 p-b-5"
                text="&#xe9c2;"
                (tap)="sendMessage()"></Label>
            </FlexboxLayout>

          </FlexboxLayout>

        </FlexboxLayout>

      </FlexboxLayout>

    </GridLayout>

  </ScrollView>

</GridLayout>
